---
title: 单片机远程升级（二）——设计思路
date: 2023-01-16 15:41:48
tags: 单片机
categories: 单片机
---

## 设计思路

### 一.将Flash区域划分为四大区域：

​	①第一块区域用来存放BootLoader程序。

​	②第二块与第三块区域可以每个分“x”KBytes大小用来存放用户应用程序——（APP1）与用户应用程序二（APP2）。

​	③第四部分用来存放各种标志位，比如程序标志，应用程序版本标志等等。

### 二.空间分布示意图

`________________________`

|		BootLoader程序区		|

|												|



|`______________________`|

|												|

|				用户AP1			     |

|												|

|`______________________`|

|												|

|				用户AP2			 	|

|												|

|`______________________`|

|需要存放在CODE区的参数  |

|`______________________`|

### 三.逻辑示意图

![单片机远程升级示意图](..\images\单片机远程升级示意图.png)

### 四.设计程序缓存区

在内部或外部存储器开辟一块区域，用于存储分包接收到的程序数据。等到全部数据接收完毕后再一次性写入到Flash进行升级。这样做有以下2点好处：

1.直接升级时间可能会比较长，影响用户正常使用，增加缓存区设计可以大大减少升级时间。

2.直接升级时，如果网络出现问题，可能导致设备无法正常启动变砖。增加缓存区设计后，即使升级数据传输失败，也不影响设备的正常使用。

